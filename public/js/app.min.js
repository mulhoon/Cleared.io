/*! DO NOT EDIT THIS FILE */
/*! File Minified by grunt @ 2015-02-02 00:20 */
/*!
 * DO NOT EDIT THIS FILE
 * File concatatenated by grunt @ 2015-02-02 00:20
 * HeadStart
 * 
 * 
 * @author Nic Mulvaney
 * @version 0.0.1
 * Copyright 2013. MIT licensed.
 */


function save(offset){savedSelection=saveSelection(document.getElementById("edit"),offset)}function restore(offset){savedSelection&&restoreSelection(document.getElementById("edit"),savedSelection,offset)}function saveSelection(){if(window.getSelection){if(sel=window.getSelection(),sel.getRangeAt&&sel.rangeCount)return sel.getRangeAt(0)}else if(document.selection&&document.selection.createRange)return document.selection.createRange();return null}function restoreSelection(range){range&&(window.getSelection?(sel=window.getSelection(),sel.removeAllRanges(),sel.addRange(range)):document.selection&&range.select&&range.select())}function setCursorToEnd(ele){var range=document.createRange(),sel=window.getSelection();range.setStart(ele,1),range.collapse(!0),sel.removeAllRanges(),sel.addRange(range),ele.focus()}function cancelEvent(e){return isInFocus===!1&&null!==savedRange?(e&&e.preventDefault?(e.stopPropagation(),e.preventDefault()):window.event.cancelBubble=!0,restoreSelection(),!1):void 0}var App=App||{},scripts=[{jquery:"//ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js"},{device:"js/vendor/device.min.js"},{moment:"js/vendor/moment.min.js"},{transparency:"js/vendor/transparency.min.js"}],event_down,event_move,event_release,transition="transitionend webkitTransitionEnd",animation="animationend webkitAnimationEnd";App.view=function(){var area,input,debug,li,but,space,curtain,currentKey,tick='<span class="tick">☐</span>',tock='<span class="tick">☑</span>',init=function(){console.log("All ready!"),area=$("#area"),edit=$("#edit"),debug=$("#debug"),input=$("#area2 .text"),li=$("<li/>"),but=$("<div class='but' />")[0],space=$("<div class='space' />")[0],curtain=$(".curtain"),actions()},parseTags=function(str){var tags={},newStr=str.replace(/[@]+[A-Za-z0-9-_():,/]+/g,function(u){var name=u.slice(1).split("(")[0];return tags[name]=!0,"<span class='tag' data-id='"+name+"'>"+u+"</span>"});return{str:newStr,tags:tags}},parseTodo=function(str,tags,el){var isList,start=str.slice(0,2);return el.removeClass("todo done"),("- "===start||"☐ "===start||"☑ "===start)&&(str.length>=2&&el.addClass("todo"),tags.done&&el.addClass("done"),str=(tags.done?tock:tick)+" "+str.slice(2),isList=!0),{text:str,todo:isList}},actions=function(){edit.on("keydown",function(e){currentKey=e.keyCode}),edit.on(event_down,".tick",toggle),edit.on("DOMSubtreeModified","p",formatLine),edit[0].addEventListener("paste",function(e){e.preventDefault();var text=e.clipboardData.getData("text/plain");text=text.replace(/<br(\s*)\/*>/gi,"\n").replace(/<[p|div]\s/gi,"\n$0").replace(/(<([^>]+)>)/gi,""),edit.html(text)})},toggle=function(e){var that=$(this);e&&(e.preventDefault(),e.stopPropagation());var val=that.text(),toggle="☐"===val?!0:!1,parent=that.parent();if(parent[0].modifying=!0,that.text(toggle?"☑":"☐"),parent[0].modifying=!1,parent.toggleClass("done",toggle),toggle){var date=moment().format("MMM,Do-hh:mm");parent.append(" @done("+date+")")}else{console.log("remove");var str=parent.text().replace(/ @done+[A-Za-z0-9-_():,]+| @done/g,"");parent.html(str)}},formatLine=function(e){$("p.active").removeClass("active");{var el=$(e.currentTarget);el.next()}if(el.addClass("active"),el[0].modifying)return!1;beginModify(el);var offsets=0,text=el.text();console.log(el[0]);var tags=parseTags(text),todo=parseTodo(tags.str,tags.tags,el),newText=todo.text;return newText?(el.html(newText),endModify(el,offsets),!1):(el.html("<br/>"),el[0].modifying=!1,void setCursorToEnd(el[0]))},beginModify=function(el){el[0].modifying=!0,save()},endModify=function(el){restore(),el[0].modifying=!1};return{init:init}}(),App.api=function(){var xhr,urls={},get=function(type,data,success,error){var url=urls[type];xhr=$.ajax({url:url,data:data,dataType:"jsonp",type:"GET",contentType:"application/json",cache:!1,timeout:15e3,success:function(data){success&&success(data)},error:function(data){"timeout"===data.statusText?console.log("Connection timed out."):"abort"!==data.statusText&&console.log("Connection error!"),error&&error(data)}})},abort=function(){xhr&&4!==xhr.readyState&&xhr.abort()};return{get:get,abort:abort}}();var ready=function(){head.js.apply(window,scripts).ready("transparency",function(){checkDevice(),App.view.init()})};window.cordova?document.addEventListener("deviceready",ready,!1):ready(),window.console=window.console||{log:function(){}};var checkDevice=function(){device.desktop()?(event_down="mousedown",event_move="mousemove",event_release="mouseup"):(event_down="touchstart",event_move="touchmove",event_release="touchend")},saveSelection,restoreSelection;window.getSelection&&document.createRange?(saveSelection=function(containerEl,offset){offset=offset?offset:0;var range=window.getSelection().getRangeAt(0),preSelectionRange=range.cloneRange();preSelectionRange.selectNodeContents(containerEl),preSelectionRange.setEnd(range.startContainer,range.startOffset);var start=preSelectionRange.toString().length+offset;return{start:start,end:start+range.toString().length}},restoreSelection=function(containerEl,savedSel,offset){offset=offset?offset:0;var charIndex=0,range=document.createRange();range.setStart(containerEl,0),range.collapse(!0);for(var node,nodeStack=[containerEl],foundStart=!1,stop=!1;!stop&&(node=nodeStack.pop());)if(3===node.nodeType){var nextCharIndex=charIndex+node.length;!foundStart&&savedSel.start>=charIndex&&savedSel.start<=nextCharIndex&&(range.setStart(node,savedSel.start-charIndex),foundStart=!0),foundStart&&savedSel.end>=charIndex&&savedSel.end<=nextCharIndex&&(range.setEnd(node,savedSel.end-charIndex),stop=!0),charIndex=nextCharIndex}else for(var i=node.childNodes.length;i--;)nodeStack.push(node.childNodes[i]);var sel=window.getSelection();sel.removeAllRanges(),sel.addRange(range)}):document.selection&&document.body.createTextRange&&(saveSelection=function(containerEl){var selectedTextRange=document.selection.createRange(),preSelectionTextRange=document.body.createTextRange();preSelectionTextRange.moveToElementText(containerEl),preSelectionTextRange.setEndPoint("EndToStart",selectedTextRange);var start=preSelectionTextRange.text.length;return{start:start,end:start+selectedTextRange.text.length}},restoreSelection=function(containerEl,savedSel){var textRange=document.body.createTextRange();textRange.moveToElementText(containerEl),textRange.collapse(!0),textRange.moveEnd("character",savedSel.end),textRange.moveStart("character",savedSel.start),textRange.select()});var savedSelection;!function(){for(var lastTime=0,vendors=["webkit","moz"],x=0;x<vendors.length&&!window.requestAnimationFrame;++x)window.requestAnimationFrame=window[vendors[x]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[vendors[x]+"CancelAnimationFrame"]||window[vendors[x]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(callback){var currTime=(new Date).getTime(),timeToCall=Math.max(0,16-(currTime-lastTime)),id=window.setTimeout(function(){callback(currTime+timeToCall)},timeToCall);return lastTime=currTime+timeToCall,id}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(id){clearTimeout(id)})}();